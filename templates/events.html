<div class="space-y-4">
  <div class="flex justify-between items-center">
    <div>
      <h3 class="text-2xl font-bold text-gray-900">Conversation Events</h3>
      <p class="text-sm text-gray-600">
        Session: {{ session_id }} | Actor: {{ actor_id }}
      </p>
    </div>
    <div class="flex items-center space-x-2">
      <span class="text-sm text-gray-500"
        >{{ events|length }} events found</span
      >
      <button
        hx-get="/memory/{{ memory_id }}/actor/{{ actor_id }}/session/{{ session_id }}/events"
        hx-target="#content"
        hx-swap="innerHTML"
        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition duration-200 flex items-center space-x-1"
        title="Refresh events list"
      >
        <svg
          class="w-4 h-4 refresh-icon"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          ></path>
        </svg>
        <div class="htmx-indicator">
          <div class="spinner"></div>
        </div>
        <span class="button-text">Refresh</span>
      </button>
      <button
        hx-get="/memory/{{ memory_id }}/actor/{{ actor_id }}/sessions"
        hx-target="#content"
        hx-swap="innerHTML"
        class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition duration-200 flex items-center"
      >
        <span class="button-text">‚Üê Back to Sessions</span>
        <div class="htmx-indicator ml-2">
          <div class="spinner"></div>
        </div>
      </button>
    </div>
  </div>

  {% if events %}
  <div class="space-y-4">
    {% for event in events %}
    <div
      class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"
    >
      <div class="flex justify-between items-start mb-3">
        <div class="flex-1">
          <h4 class="font-semibold text-lg text-gray-900">
            {{ event.eventId }}
          </h4>
          <div class="flex items-center mt-1 space-x-4">
            <span class="text-xs text-gray-500"
              >{{ event.eventTimestamp | format_datetime }}</span
            >
            {% if event.branch %}
            <span
              class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"
            >
              Branch: {{ event.branch.name }}
            </span>
            {% endif %}
          </div>
        </div>
      </div>

      {% if event.payload %}
      <div class="space-y-3">
        {% for payload_item in event.payload %} {% if
        payload_item.conversational %}
        <div class="bg-gray-50 rounded-lg p-3">
          <div class="flex items-center mb-2">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if payload_item.conversational.role == 'USER' %}bg-blue-100 text-blue-800 {% elif payload_item.conversational.role == 'ASSISTANT' %}bg-green-100 text-green-800 {% elif payload_item.conversational.role == 'TOOL' %}bg-yellow-100 text-yellow-800 {% else %}bg-gray-100 text-gray-800{% endif %}"
            >
              {{ payload_item.conversational.role }}
            </span>
          </div>
          {% if payload_item.conversational.content and
          payload_item.conversational.content.text %}
          <div class="text-sm text-gray-700 whitespace-pre-wrap">
            {{ payload_item.conversational.content.text }}
          </div>
          {% endif %}
        </div>
        {% elif payload_item.blob %}
        <div class="bg-yellow-50 rounded-lg p-3">
          <div class="flex items-center mb-2">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"
            >
              BLOB DATA
            </span>
          </div>
          <div class="text-sm text-gray-700">
            <pre class="bg-white p-2 rounded border text-xs overflow-x-auto">
{{ payload_item.blob | tojson(indent=2) }}</pre
            >
          </div>
        </div>
        {% endif %} {% endfor %}
      </div>
      {% else %}
      <div class="text-sm text-gray-500 italic">No payload data available</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-12">
    <div class="text-gray-400 mb-4">
      <svg
        class="mx-auto h-12 w-12"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
        />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No events found</h3>
    <p class="text-gray-500">
      No conversation events are available for this session.
    </p>
  </div>
  {% endif %}
</div>
